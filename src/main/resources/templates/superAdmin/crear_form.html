<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <title>Dashboard - NiceAdmin Bootstrap Template</title>
    <meta content="" name="description">
    <meta content="" name="keywords">

    <!-- Favicons -->
    <link th:href="@{/assets/img/favicon.png}" rel="icon">
    <link th:href="@{/assets/img/apple-touch-icon.png}" rel="apple-touch-icon">

    <!-- Google Fonts -->
    <link href="https://fonts.gstatic.com" rel="preconnect">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i|Nunito:300,300i,400,400i,600,600i,700,700i|Poppins:300,300i,400,400i,500,500i,600,600i,700,700i"
          rel="stylesheet">
    <!-- BOOTSTRAP -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
          crossorigin="anonymous">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css">



    <!-- Vendor CSS Files -->
    <link th:href="@{/assets/vendor/bootstrap/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/bootstrap-icons/bootstrap-icons.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/boxicons/css/boxicons.min.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/quill/quill.snow.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/quill/quill.bubble.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/remixicon/remixicon.css}" rel="stylesheet">
    <link th:href="@{/assets/vendor/simple-datatables/style.css}" rel="stylesheet">

    <!-- Template Main CSS File -->
    <link th:href="@{/assets/css/stylesuperadmin.css}" rel="stylesheet">

    <!-- =======================================================
    * Template Name: NiceAdmin
    * Updated: Mar 09 2023 with Bootstrap v5.2.3
    * Template URL: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/
    * Author: BootstrapMade.com
    * License: https://bootstrapmade.com/license/
    ======================================================== -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
     aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="staticBackdropLabel"></div>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary">Loguearse</button>
            </div>
        </div>
    </div>
</div>

<!-- ======= Header ======= -->
<div th:replace="~{superAdmin/fragments/header.html :: header}"></div>
<!-- End Header -->

<!-- ======= Sidebar ======= -->
<div th:replace="~{superAdmin/fragments/sidebar.html :: sidebar}"></div>
<!-- End Sidebar-->
<main id="main" class="main">

    <div class="pagetitle">
        <h1>Clínica INTERPUCP</h1>
        <nav>
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item active">Formulario</li>
                <li class="breadcrumb-item active">Crear formulario</li>
            </ol>
        </nav>
    </div>
    <!-- End Page Title -->
    <!--<section class="section">
        <div class="row align-items-center">
            &lt;!&ndash; Fila para los botones &ndash;&gt;
            <div class="row mb-3">
                <div class="col-lg-12 d-flex justify-content-start">
                    <button id="add-row" type="button" class="btn btn-danger me-2">Añadir fila</button>
                    <button id="remove-row" type="button" class="btn btn-danger me-2">Eliminar fila</button>
                    &lt;!&ndash; Espacio entre los botones &ndash;&gt;
                    <div style="flex-grow: 1"></div>
                    &lt;!&ndash; Botón para guardar formulario &ndash;&gt;
                    <button id="save-form" type="button" class="btn btn-primary">Guardar formulario</button>
                </div>
            </div>
            <div class="col-lg-4 container" id="my-container">
                &lt;!&ndash; Fila para el formulario &ndash;&gt;
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title" contentEditable="true">Titulo de formulario</h5>

                                &lt;!&ndash; General Form Elements &ndash;&gt;
                           &lt;!&ndash;     <form id="dynamic-form" method="post" action="/administrativo/invitar">
                                    <div id="form-rows">
                                        &lt;!&ndash; Las filas del formulario se agregarán aquí &ndash;&gt;
                                    </div>
                                    <div class="text-center">
                                        <button type="button" class="btn btn-primary">Enviar invitación</button>
                                        <a type="button" class="btn btn-secondary" href="#">Cancelar</a>
                                    </div>
                                </form>&lt;!&ndash; End General Form Elements &ndash;&gt;
&ndash;&gt;
                                <form id="my-form" th:action="@{/SuperAdminHomePage/guardarFormulario}" method="POST">
                                    <label for="titulo">Título:</label><br>
                                    <input type="text" id="titulo" name="titulo" required><br>
                                    <label for="estructura_formulario">Estructura del formulario (max 5000 caracteres):</label><br>
                                    <textarea id="estructura_formulario" name="estructura_formulario" maxlength="5000" required></textarea><br>
                                    <input type="hidden" id="sent" name="sent" value="1">
&lt;!&ndash;
                                    <input id="save-form" type="button" value="Guardar">
&ndash;&gt;
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>-->
   <!-- <section class="section">
        <div class="row align-items-center">
            &lt;!&ndash; Fila para los botones &ndash;&gt;
            <div class="row mb-3">
                <div class="col-lg-12 d-flex justify-content-start">
                    <button id="add-row" type="button" class="btn btn-danger me-2">Añadir fila</button>
                    <button id="remove-row" type="button" class="btn btn-danger me-2">Eliminar fila</button>
                    &lt;!&ndash; Espacio entre los botones &ndash;&gt;
                    <div style="flex-grow: 1"></div>
                    &lt;!&ndash; Botón para guardar formulario &ndash;&gt;
                    <button id="save-form" type="button" class="btn btn-primary">Guardar formulario</button>
                </div>
            </div>
            <div class="col-lg-4 container" id="my-container">
                &lt;!&ndash; Fila para el formulario &ndash;&gt;
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title" contentEditable="true">Titulo de formulario</h5>
                                &lt;!&ndash; General Form Elements &ndash;&gt;
                                <form id="my-form" th:action="@{/SuperAdminHomePage/guardarFormulario}" method="POST">
                                    <div id="form-rows">
                                        &lt;!&ndash; Las filas del formulario se agregarán aquí &ndash;&gt;
                                    </div>
                                    <input type="hidden" id="titulo" name="titulo" required>
                                    <input type="hidden" id="estructura_formulario" name="estructura_formulario" maxlength="5000" required>
&lt;!&ndash;
                                    <input type="hidden" id="sent" name="sent" value="true">
&ndash;&gt;
                                  &lt;!&ndash;  <div class="text-center">
                                        <button type="button" class="btn btn-primary">Enviar invitación</button>
                                        <a type="button" class="btn btn-secondary" href="#">Cancelar</a>
                                    </div>&ndash;&gt;
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>-->
    <section class="section">
        <div class="row align-items-center">
            <!-- Fila para los botones -->
            <div class="row mb-3">
                <div class="col-lg-12 d-flex justify-content-start">
                    <!-- Espacio entre los botones -->
                    <div style="flex-grow: 1"></div>
                    <!-- Botón para guardar formulario -->
                    <button id="save-form" type="button" class="btn btn-primary">Guardar formulario</button>
                </div>
            </div>
            <div class="col-lg-5 container" id="my-container">
                <!-- Fila para el formulario -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-body">
                                <h5 class="card-title" contentEditable="true">Titulo de formulario</h5>
                                <!-- General Form Elements -->
                                <form id="my-form" th:action="@{/SuperAdminHomePage/guardarFormulario}" method="POST">
                                    <div id="form-rows">
                                        <!-- Un campo de formulario por defecto -->
                                        <div class="row mb-3">
                                            <div class="col-sm-3">
                                                <label class="col-form-label" contentEditable="true">Nuevo Campo</label>
                                            </div>
                                            <div class="col-sm-6">
                                                <input type="text" class="form-control">
                                            </div>
                                            <div class="col-sm-1">
                                                <button type="button" class="btn btn-circle btn-success add-row" title="Agregar campo"><i class="fas fa-plus"></i></button>
                                            </div>
                                            <div class="col-sm-1">
                                                <button type="button" class="btn btn-circle btn-danger remove-row" title="Eliminar campo" disabled><i class="fas fa-minus"></i></button>
                                            </div>
                                        </div>
                                        <!-- Las filas adicionales del formulario se agregarán aquí -->
                                    </div>
                                    <input type="hidden" id="titulo" name="titulo" required>
                                    <input type="hidden" id="estructura_formulario" name="estructura_formulario" maxlength="5000" required>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

</main><!-- End #main -->

<!-- ======= Footer ======= -->
<footer id="footer" class="footer">
    <div class="copyright">
        &copy; Copyright <strong><span>Clínica InterPUCP</span></strong>. All Rights Reserved
    </div>
    <div class="credits">
        <!-- All the links in the footer should remain intact. -->
        <!-- You can delete the links only if you purchased the pro version. -->
        <!-- Licensing information: https://bootstrapmade.com/license/ -->
        <!-- Purchase the pro version with working PHP/AJAX contact form: https://bootstrapmade.com/nice-admin-bootstrap-admin-html-template/ -->
        Designed by <a href="https://bootstrapmade.com/">BootstrapMade</a>
    </div>
</footer><!-- End Footer -->

<a href="#" class="back-to-top d-flex align-items-center justify-content-center"><i
        class="bi bi-arrow-up-short"></i></a>
<script>
    var darkmode = localStorage.getItem('dark-mode') === 'true';

    var headerColor = "[[${headerColor}]]";
    console.log(headerColor);
    localStorage.setItem('headerColor', headerColor);

    /*  console.log(darkmode ? 'Modo oscuro activado' : 'Modo claro activado');
      var sidebarColor = "[[${sidebarColor}]]";
      localStorage.setItem('sidebarColor', sidebarColor);
*/


    var darkModeButton = document.getElementById('dark-mode-button');

    function updateBodyClasses() {
        document.body.classList.toggle('dark-mode', darkmode);
        document.body.classList.toggle('light-mode', !darkmode);
    }

    function updateHeaderColor() {
        var color = darkmode ? '#363537' : headerColor;
        document.getElementById('header').style.backgroundColor = color;
        console.log(darkmode ? 'saludo' : 'despedida');
    }

    /*   function updateSidebarColor() {
           var color = darkmode ? '#363537' : sidebarColor;
           document.getElementById('sidebar').style.backgroundColor = color;
       }*/
    function setDarkMode(newValue) {
        darkmode = newValue;
        localStorage.setItem('dark-mode', newValue);
        updateBodyClasses();
        updateHeaderColor();
        /*
                        updateSidebarColor(); // Añadir esta línea
        */

    }

    updateBodyClasses();
    updateHeaderColor();
    /*
                updateSidebarColor(); // Añadir esta línea
    */
    document.addEventListener('DOMContentLoaded', (event) => {
        document.getElementById('dark-mode-button').checked = darkmode;
        document.getElementById('dark-mode-button').addEventListener('change', function () {
            setDarkMode(this.checked);
        });
    });
</script>
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<!--<script>
    document.addEventListener('DOMContentLoaded', function() {
        var title = document.querySelector('.card-title');
        title.addEventListener('focus', function() {
            if (this.textContent === 'Titulo de formulario') {
                this.textContent = '';
            }
        });
    });

    document.getElementById('add-row').addEventListener('click', function () {
        var formRows = document.getElementById('form-rows');

        var newRow = document.createElement('div');
        newRow.className = 'row mb-3';

        var label = document.createElement('label');
        label.className = 'col-sm-4 col-form-label';
        label.contentEditable = 'true';
        label.textContent = 'Nuevo campo';
        label.addEventListener('focus', function () {
            if (this.textContent === 'Nuevo campo') {
                this.textContent = '';
            }
        });

        var inputContainer = document.createElement('div');
        inputContainer.className = 'col-sm-8';

        var input = document.createElement('input');
        input.type = 'text';
        input.className = 'form-control';

        inputContainer.appendChild(input);
        newRow.appendChild(label);
        newRow.appendChild(inputContainer);

        formRows.appendChild(newRow);
    });

    document.getElementById('remove-row').addEventListener('click', function () {
        var formRows = document.getElementById('form-rows');
        var rows = formRows.getElementsByClassName('row mb-3');
        var lastRow = rows[rows.length - 1];
        if (lastRow) {
            formRows.removeChild(lastRow);
        }
    });
</script>-->
<!--<script>
    document.getElementById('save-form').addEventListener('click', function (event) {
        event.preventDefault();
        // Obtiene el título del formulario
        var title = document.querySelector('.card-title').textContent;
        // Guarda el título en el campo de entrada correspondiente
        document.getElementById('titulo').value = title;
        // Obtiene las filas del formulario
        var formRows = document.getElementById('form-rows');
        var rows = formRows.getElementsByClassName('row mb-3');
        // Recopila la información de los campos de entrada
        var fields = Array.from(rows).map(row => {
            var label = row.querySelector('.col-form-label').textContent;
            var input = row.querySelector('.form-control');
            return {
                type: input.type,
                label: label,
                id: input.id,
                name: input.name
            };
        });
        // Convierte los datos recopilados a formato JSON y los añade a un objeto con la clave "fields"
        var formStructureJSON = JSON.stringify({ fields: fields });
        // Guarda la estructura del formulario en el campo de entrada correspondiente
        document.getElementById('estructura_formulario').value = formStructureJSON;
        // Envía el formulario
        document.getElementById('my-form').submit();
    });
</script>-->
<!--<script>
    document.addEventListener('click', function(e) {
        var formRows = document.getElementById('form-rows');
        var buttons = formRows.getElementsByClassName('remove-row');

        if (e.target && e.target.classList.contains('add-row')) {
            // Código para agregar fila
            var newRow = document.createElement('div');
            newRow.className = 'row mb-3';
            newRow.innerHTML = `
            <div class="col-sm-3">
                <label class="col-form-label" contentEditable="true">New Field</label>
            </div>
            <div class="col-sm-6">
                <input type="text" class="form-control">
            </div>
            <div class="col-sm-1">
                <button type="button" class="btn btn-circle btn-success add-row" title="Agregar campo"><i class="fas fa-plus"></i></button>
            </div>
            <div class="col-sm-1">
                <button type="button" class="btn btn-circle btn-danger remove-row" title="Eliminar campo"><i class="fas fa-minus"></i></button>
            </div>`;
            formRows.appendChild(newRow);

            // Habilita todos los botones de eliminación si hay más de un campo
            if (buttons.length > 1) {
                for (var i = 0; i < buttons.length; i++) {
                    buttons[i].disabled = false;
                }
            }
        }

        if (e.target && e.target.classList.contains('remove-row')) {
            // Código para eliminar fila
            e.target.parentNode.parentNode.remove();

            // Deshabilita el botón de eliminación si solo queda un campo
            if (buttons.length === 1) {
                buttons[0].disabled = true;
            }
        }
    });
</script>
<script>
    document.getElementById('save-form').addEventListener('click', function (event) {
        event.preventDefault();
        // Obtiene el título del formulario
        var title = document.querySelector('.card-title').textContent;
        // Guarda el título en el campo de entrada correspondiente
        document.getElementById('titulo').value = title;

        console.log("Título del formulario: " + title); // Log del título

        // Obtiene las filas del formulario
        var formRows = document.getElementById('form-rows');
        var rows = formRows.getElementsByClassName('row mb-3');
        // Recopila la información de los campos de entrada
        var fields = Array.from(rows).map(row => {
            var label = row.querySelector('.col-form-label').textContent;
            var input = row.querySelector('.form-control');
            return {
                type: input.type,
                label: label,
                id: input.id,
                name: input.name
            };
        });

        console.log("Campos del formulario: ", fields); // Log de los campos

        // Convierte los datos recopilados a formato JSON y los añade a un objeto con la clave "fields"
        var formStructureJSON = JSON.stringify({ fields: fields });
        // Guarda la estructura del formulario en el campo de entrada correspondiente
        document.getElementById('estructura_formulario').value = formStructureJSON;

        console.log("Estructura del formulario en JSON: " + formStructureJSON); // Log del JSON

        // Envía el formulario
        document.getElementById('my-form').submit();

    });
</script>-->
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        updateEventListeners();
        bindSaveButton();
    });
    function convertFormStructureToJSON() {
        var formRows = document.getElementById('form-rows').children;
        var formStructure = { fields: [] };
        var tituloElement = document.querySelector('.card-title');
        var titulo = tituloElement.textContent;

        // Aquí es donde guardas el valor del título en el campo de entrada oculto
        document.getElementById('titulo').value = titulo;

        for (var i = 0; i < formRows.length; i++) {
            var row = formRows[i];
            var label = row.querySelector('.col-form-label').textContent;
            var input = row.querySelector('.form-control');

            formStructure.fields.push({
                type: input.type,
                label: label
            });
        }

        document.getElementById('estructura_formulario').value = JSON.stringify(formStructure);
    }

    function updateEventListeners() {
        var formRows = document.getElementById('form-rows');
        var addButtons = formRows.getElementsByClassName('add-row');
        var removeButtons = formRows.getElementsByClassName('remove-row');

        Array.from(addButtons).forEach(function(addButton) {
            // Elimina el event listener antiguo
            var newButton = addButton.cloneNode(true);
            addButton.parentNode.replaceChild(newButton, addButton);

            // Añade el nuevo event listener
            newButton.addEventListener('click', function(e) {
                // Código para agregar fila
                var newRow = document.createElement('div');
                newRow.className = 'row mb-3';
                newRow.innerHTML = `
            <div class="col-sm-3">
                <label class="col-form-label" contentEditable="true">Nuevo Campo</label>
            </div>
            <div class="col-sm-6">
                <input type="text" class="form-control">
            </div>
            <div class="col-sm-1">
                <button type="button" class="btn btn-circle btn-success add-row" title="Agregar campo"><i class="fas fa-plus"></i></button>
            </div>
            <div class="col-sm-1">
                <button type="button" class="btn btn-circle btn-danger remove-row" title="Eliminar campo"><i class="fas fa-minus"></i></button>
            </div>`;
                formRows.appendChild(newRow);

                // Actualiza los listeners de eventos
                updateEventListeners();
            });
        });

        Array.from(removeButtons).forEach(function(removeButton) {
            // Elimina el event listener antiguo
            var newButton = removeButton.cloneNode(true);
            removeButton.parentNode.replaceChild(newButton, removeButton);

            // Añade el nuevo event listener
            newButton.addEventListener('click', function(e) {
                // Código para eliminar fila
                e.target.closest('.row').remove();

                // Actualiza los listeners de eventos
                updateEventListeners();

                // Deshabilita el botón de eliminación si solo queda un campo
                var updatedRemoveButtons = formRows.getElementsByClassName('remove-row');
                if (updatedRemoveButtons.length === 1) {
                    updatedRemoveButtons[0].disabled = true;
                }
            });
        });

        // Habilita todos los botones de eliminación si hay más de un campo
        if (removeButtons.length > 1) {
            for (var i = 0; i < removeButtons.length; i++) {
                removeButtons[i].disabled = false;
            }
        } else if (removeButtons.length === 1) {
            removeButtons[0].disabled = true;
        }
    }
    function bindSaveButton() {
        var saveButton = document.getElementById('save-form');
        var form = document.getElementById('my-form');

        saveButton.addEventListener('click', function(e) {
            e.preventDefault(); // previene el comportamiento por defecto del botón
            convertFormStructureToJSON(); // Convierte la estructura del formulario a JSON y guarda en los campos ocultos
            form.submit(); // envía el formulario
        });
    }
</script>

<!-- Vendor JS Files -->
<script th:src="@{/assets/vendor/apexcharts/apexcharts.min.js}"></script>
<script th:src="@{/assets/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/assets/vendor/chart.js/chart.umd.js}"></script>
<script th:src="@{/assets/vendor/echarts/echarts.min.js}"></script>
<script th:src="@{/assets/vendor/quill/quill.min.js}"></script>
<script th:src="@{/assets/vendor/simple-datatables/simple-datatables.js}"></script>
<script th:src="@{/assets/vendor/tinymce/tinymce.min.js}"></script>
<script th:src="@{/assets/vendor/php-email-form/validate.js}"></script>

<!-- Template Main JS File -->
<script th:src="@{/assets/js/main.js}"></script>


</body>

</html>